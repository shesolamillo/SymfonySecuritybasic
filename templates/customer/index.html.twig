{% extends 'base.html.twig' %}

{% block title %}Customer Index{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/customer_index.css') }}">
{% endblock %}

{% block body %}
<div class="container">
    <div class="header">
        <h1>Customer Management</h1>

        <div class="controls">
            <input type="text" placeholder="Search customer...">
            <a href="{{ path('app_customer_new') }}" class="create-btn">+ Add Customer</a>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Created At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in customers %}
                <tr>
                    <td>{{ customer.id }}</td>
                    <td>{{ customer.firstName }}</td>
                    <td>{{ customer.lastName }}</td>
                    <td>{{ customer.email }}</td>
                    <td>{{ customer.phone }}</td>
                    <td>{{ customer.createdAt ? customer.createdAt|date('Y-m-d H:i') : '' }}</td>
                    <td class="actions">
                        <a href="{{ path('app_customer_show', {'id': customer.id}) }}" class="show">Show</a>
                        <a href="{{ path('app_customer_edit', {'id': customer.id}) }}" class="edit">Edit</a>
                        <a href="#" class="delete" onclick="confirmDelete('{{ path('app_customer_delete', {'id': customer.id}) }}')">Delete</a>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="7" style="text-align:center;">No records found</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Notification & Modal -->
<div id="notification" class="notification">Deleted successfully!</div>

<div id="deleteModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <p>Are you sure you want to delete this customer?</p>
        <form id="deleteForm" method="post">
            <input type="hidden" name="_token" value="{{ csrf_token('delete_customer') }}">
            <button type="submit" class="create-btn">Confirm Delete</button>
        </form>
    </div>
</div>

<script>
    function confirmDelete(actionUrl) {
        const modal = document.getElementById('deleteModal');
        const form = document.getElementById('deleteForm');
        form.action = actionUrl;
        modal.style.display = 'block';
    }

    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }
</script>
{% endblock %}
